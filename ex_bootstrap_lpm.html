<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BSP430: Bootstrapping a New Platform: Basic LPM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20130327</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Bootstrapping a New Platform: Basic LPM </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This program disables the watchdog, configures for LPM, then enters LPM, bypassing all BSP430 initialization code. As an exception, if requested the board will flash the first two LEDs for a few seconds when it starts, to confirm that the application board is running.</p>
<p>If everything goes right, you can measure the board power consumption and compare that to what's on the data sheet. It's likely that you'll have to remove jumpers and/or disconnect any USB or RS232 connection in order to get power consumption all the way down to where it needs to be. Some platform-specific notes:</p>
<h1><a class="anchor" id="EXP430-G2"></a>
EXP430-G2</h1>
<p>LaunchPad board revisions prior to 1.5 cannot achieve the lowest power mode without hardware modifications. To do the best you can, remove the TXD, RXD, and TEST jumpers connecting the emulation side of the board from the EXP430G2 side of the board (you can leave or remove RST). Measure the current across the Vcc jumper using an ammeter. The lowest current measurement you are likely to see is 76 uA in LPM4 when powering from the emulation USB port.</p>
<p>If you completely disconnect the emulation side and power from battery, you can get down to 65 uA on this revision of the hardware.</p>
<p>If you have revision 1.5 of the hardware, following the same process should get you around 0.1 uA with LPM4. The TXD/RXD and TEST jumpers may be left in place, but RST and VCC should be removed.</p>
<h1><a class="anchor" id="Enhanced"></a>
Compile-time Configuration</h1>
<p>Note that this example includes infrastructure that allows configuring the build through the command line. For example, to enter LPM mode 2 with the LED notification, use the following as your build command:</p>
<div class="fragment"><div class="line">make LPM=2 LED=1 realclean install</div>
</div><!-- fragment --><p>By default, LEDs are disabled and LPM4 will be entered.</p>
<h1><a class="anchor" id="ex_bootstrap_lpm_main"></a>
main.c</h1>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html" title="Entrypoint for platform-specific capabilities.">bsp430/platform.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html" title="Clock-related functions implemented on all MSP430 MCUs.">bsp430/clock.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="lpm_8h.html" title="Support for low power mode execution.">bsp430/lpm.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="led_8h.html" title="Support for platform-independent LED manipulation.">bsp430/utility/led.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lpm_bits[] = {</div>
<div class="line">  <a class="code" href="msp430_8h.html#a44fde789b84d1b15c41e577d6a080eff">LPM0_bits</a>,</div>
<div class="line">  <a class="code" href="msp430_8h.html#a1de78c710e50d6f742f5676dfbffdedf">LPM1_bits</a>,</div>
<div class="line">  <a class="code" href="msp430_8h.html#a8af1e5b3633693d9439d284100183004">LPM2_bits</a>,</div>
<div class="line">  <a class="code" href="msp430_8h.html#ae8217664a1729103e247c6984d1744cc">LPM3_bits</a>,</div>
<div class="line">  <a class="code" href="msp430_8h.html#a97eaedd508e6f77e34a49433f8e9e2eb">LPM4_bits</a></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main ()</div>
<div class="line">{</div>
<div class="line">  WDTCTL = WDTPW | WDTHOLD;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if BSP430_LED - 0</span></div>
<div class="line"><span class="preprocessor"></span>  <a class="code" href="led_8h.html#afc1e43d4f426d08ed4c123d41167877a">vBSP430ledInitialize_ni</a>();</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 1);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 20; ++i) {</div>
<div class="line">      <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, -1);</div>
<div class="line">      <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(1, -1);</div>
<div class="line">      __delay_cycles(<a class="code" href="clock_8h.html#a24c49529cfa0ba1ada6819dfe6c5d68e">BSP430_CLOCK_PUC_MCLK_HZ</a> / 10);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* The subsequent vBSP430lpmConfigurePortsForLPM_ni() call should</span></div>
<div class="line"><span class="comment">     * turn off the LED that&#39;s still lit. */</span></div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="lpm_8h.html#ae15c7d81249ba5baff6f031a6612141b">vBSP430lpmConfigurePortsForLPM_ni</a>();</div>
<div class="line"></div>
<div class="line">  __delay_cycles(<a class="code" href="clock_8h.html#a24c49529cfa0ba1ada6819dfe6c5d68e">BSP430_CLOCK_PUC_MCLK_HZ</a>);</div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line"><span class="preprocessor">#if (0 &lt;= APP_LPM) &amp;&amp; (APP_LPM &lt;= 4)</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="core_8h.html#ab3ba0bc9be345eb561a58747da602704">BSP430_CORE_LPM_ENTER_NI</a>(lpm_bits[APP_LPM]);</div>
<div class="line">    <span class="comment">/* For this application it doesn&#39;t matter that GIE is now set */</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ex_bootstrap_lpm_confic"></a>
bsp430_config.h</h1>
<div class="fragment"><div class="line"><span class="comment">/* No console, no uptime, no crystal.  Will not invoke platform</span></div>
<div class="line"><span class="comment"> * initialize, so no need to configure those.  The only thing needed</span></div>
<div class="line"><span class="comment"> * is to specify the target LPM mode. */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef APP_LPM</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define APP_LPM 4</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* APP_LPM */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* Get platform defaults */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bsp430__config_8h.html" title="BSP430 application and platform configuration directives.">bsp430/platform/bsp430_config.h</a>&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="ex_bootstrap_lpm_make"></a>
Makefile</h1>
<div class="fragment"><div class="line">LPM ?= 4</div>
<div class="line">LED ?= 0</div>
<div class="line">AUX_CPPFLAGS += -DAPP_LPM=$(LPM) -DconfigBSP430_LED=$(LED)</div>
<div class="line">PLATFORM ?= exp430fr5739</div>
<div class="line">MODULES=$(MODULES_PLATFORM)</div>
<div class="line">MODULES += lpm</div>
<div class="line">SRC=main.c</div>
<div class="line">include $(BSP430_ROOT)/examples/Makefile.common</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 27 2013 12:01:54 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
