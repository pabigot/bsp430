<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BSP430: The BSP430 Build Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20130427</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The BSP430 Build Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The current BSP430 build environment is based on GNU make, and uses a fairly complex shared Makefile.common to reduce the amount of boilerplate that's required in application-specific Makefiles.</p>
<p>First, the environment variable <code>BSP430_ROOT</code> should be set to point to the root of your BSP430 installation: that is the directory containing the <code>include</code>, <code>src</code>, and <code>examples</code> directories.</p>
<p>Consider the following basic Makefile, taken from <a class="el" href="ex_bootstrap_nop.html">the null program</a>:</p>
<div class="fragment"><div class="line">PLATFORM ?= exp430fr5739</div>
<div class="line">MODULES=$(MODULES_PLATFORM)</div>
<div class="line">SRC=main.c</div>
<div class="line">include $(BSP430_ROOT)/examples/Makefile.common</div>
</div><!-- fragment --><p>This specifies all you need:</p>
<ul>
<li>The <code>PLATFORM</code> variable identifies the target for the application. In this case, the default is for the EXP430FR5739 "Fraunchpad", but the syntax indicates that prior definitions including ones passed on the command line take precedence.</li>
</ul>
<ul>
<li>The <code>MODULES</code> variable specifies the elements of BSP430 that must be compiled and linked to produce the executable. <code>MODULES_PLATFORM</code> is defined by the infrastructure based on the value of <code>PLATFORM</code>, and contains the platform-specific source along with the modules that provide the uptime timer and LED support. Other modules are specified by their root file name within the BSP430 src directory, e.g. <code>utility/onewire</code>.</li>
</ul>
<ul>
<li>The <code>SRC</code> variable lists the C source files that are application specific.</li>
</ul>
<ul>
<li>The <code>include</code> directive loads in the standard infrastructure that actually builds the application</li>
</ul>
<p>The make infrastructure will build a list of sources by combining information from <code>MODULES</code> and <code>SRC</code>, scan them and create dependency files based on what headers they require, build the application, and download it to the target board. It supports these standard rules:</p>
<ul>
<li><code>app.elf</code> builds the application into an ELF executable</li>
</ul>
<ul>
<li><code>clean</code> removes all object files, leaving the application and any dependency files</li>
</ul>
<ul>
<li><code>realclean</code> removes the object files and application along with any dependency files that were created</li>
</ul>
<ul>
<li><code>install</code> builds <code>app.elf</code> then programs it onto the board using rules determined by the <code>PLATFORM</code> </li>
</ul>
<p>There are a large number of other options and features including:</p>
<ul>
<li>Ability to modify <code>CPPFLAGS</code>, <code>LDFLAGS</code>, <code>CFLAGS</code>, and target-specific flags such as memory model both from the application Makefile (e.g., <code>AUX_CPPFLAGS</code>) and from the command-line (e.g., <code>EXT_CPPFLAGS</code>);</li>
</ul>
<ul>
<li>Pre-defined variables supplying core functionality in a platform-independent manner, such as <code>MODULES_SERIAL</code>, <code>MODULES_CONSOLE</code>, and other common generic features;</li>
</ul>
<ul>
<li>A target <code>foo.lst</code> which produces an interleaved source/assembler listing for the source file <code>foo.c</code>;</li>
</ul>
<ul>
<li>Full control over how applications are downloaded into devices</li>
</ul>
<p>All of which are documented in <code>${BSP430_ROOT}/examples/Makefile.common</code>. For more details read that file and review the Makefiles in the examples directories.</p>
<p>Here is one last example, the Makefile for the <a class="el" href="ex_bootstrap_applpm.html">the application LPM program</a>:</p>
<div class="fragment"><div class="line">MCLK ?= 1000000</div>
<div class="line">AUX_CPPFLAGS += -DBSP430_CLOCK_NOMINAL_MCLK_HZ=$(MCLK)</div>
<div class="line">PLATFORM ?= exp430fr5739</div>
<div class="line">MODULES = $(MODULES_PLATFORM)</div>
<div class="line">MODULES += $(MODULES_UPTIME)</div>
<div class="line">MODULES += $(MODULES_CONSOLE)</div>
<div class="line">MODULES += periph/port</div>
<div class="line">MODULES += periph/sys</div>
<div class="line">MODULES += periph/pmm</div>
<div class="line">MODULES += lpm</div>
<div class="line">SRC=main.c</div>
<div class="line">include $(BSP430_ROOT)/examples/Makefile.common</div>
</div><!-- fragment --><p>Using this, if you wanted to build a version that configured the clocks at 16 MHz and used the crystal, and immediately download it to the target, you would use:</p>
<div class="fragment"><div class="line">make \</div>
<div class="line">   EXT_CPPFLAGS=-DBSP430_PLATFORM_BOOT_CONFIGURE_LFXT1=1 \</div>
<div class="line">   MCLK=16000000 \</div>
<div class="line">   realclean install</div>
</div><!-- fragment --><p>Copyright 2012-2013, Peter A. Bigot </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 27 2013 18:46:22 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
