<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BSP430: Utilities: Command Line Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20140310</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Utilities: Command Line Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The &lt;<a class="el" href="cli_8h.html" title="Basic support for command line processing. ">bsp430/utility/cli.h</a>&gt; header provides a simple way to implement a command line interface within a program that uses &lt;<a class="el" href="console_8h.html" title="A generic console output capability. ">bsp430/utility/console.h</a>&gt;. Each command is implemented in its own function, and registered as available by linking them into a chain of static structures at compile-time. The example below shows how this can be done in a way that makes it simple to include or exclude commands based on development needs and available options.</p>
<p>The module also provides utilities that make it easy to add commands for users to reconfigure parameters of various types, obtain help on the available commands, and implement nested commands.</p>
<p>The example below supports the following commands: </p>
<pre class="fragment">&gt; help
help [cmd] # Show help on cmd or all commands
say {word}... # Customized completion demonstration
complete # No help available
  component # No help available
  common # No help available
quote [qstr]... # Extract one or more quoted tokens
set # No help available
  ulval [unsigned 32-bit integer in octal, decimal, or hex]
  lval [signed 32-bit integer in octal, decimal, or hex]
  uival [unsigned 16-bit integer in octal, decimal, or hex]
  ival [signed 16-bit integer in octal, decimal, or hex]
  all [ival] [ [uival] [ [lval] [ [ulval] ] ] ]
show # Display the value of variables
expand [command...] # Show the expansion of the command without executing it
uptime # Show system uptime
hup # No help available
  two # valid if no three
    three # invalid if no four
      four # No help available
</pre><p>Below is a capture from an interactive session with the application. Where the sequence <code>&lt;TAB&gt;</code> appears a tab character was typed. Where the sequence <code>&lt;UP&gt;</code> appears the up-arrow on an ANSI terminal was pressed. See <a class="el" href="group__grp__utility__cli__cli.html#gaf192635722fef70abb4583a1c52a4e7a">iBSP430cliConsoleBufferProcessInput()</a> for a table showing command metacharacters.</p>
<pre class="fragment">&gt; uptime
Up  1:25.337
&gt; up
Up  1:26.129
&gt; exp h t t 4
Expanded: ( h t t 4)
&gt; exp hu t t 4
Expanded: hup two three( 4)
&gt; hu t t f
Display: hup two three four
WTH are we fighting for? Walk!

&gt; sh
ival 0
uival 0 (0x0)
lval 0
ulval 0 (0x0)
&gt; set i 0x23
&gt; sh
ival 35
uival 0 (0x0)
lval 0
ulval 0 (0x0)
&gt; set all -5 -010 -1 -1
&gt; sh
ival -5
uival 65528 (0xfff8)
lval -1
ulval 4294967295 (0xffffffff)
&gt; quote "one two" and "three four"
Extracting text tokens from 27 characters
7-char token &lt;one two&gt;
3-char token &lt;and&gt;
10-char token &lt;three four&gt;
&gt; s&lt;TAB&gt;
Candidates: say set show
&gt; say &lt;TAB&gt;
Candidates: zero one two three four (+ 6 more)
&gt; say t&lt;TAB&gt;
Candidates: two three ten
&gt; say three
Match three for 6 consumed position 3
1 matches found
&gt; say ten five sev
Match ten for 4 consumed position 10
Match five for 5 consumed position 5
Match seven for 4 consumed position 7
3 matches found
&gt;
&gt; &lt;UP&gt;escape char 0x5b (91) '['
escape char 0x41 (65) 'A'
Leaving escape mode</pre><h1><a class="anchor" id="ex_utility_cli_main"></a>
main.c</h1>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html">bsp430/platform.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html">bsp430/clock.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uptime_8h.html">bsp430/utility/uptime.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="console_8h.html">bsp430/utility/console.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cli_8h.html">bsp430/utility/cli.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="led_8h.html">bsp430/utility/led.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pmm_8h.html">bsp430/periph/pmm.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>data_t {</div>
<div class="line">  <span class="keywordtype">int</span> ival;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uival;</div>
<div class="line">  <span class="keywordtype">long</span> lval;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulval;</div>
<div class="line">} data;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">dumpData (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ival %d\n&quot;</span>, data.ival);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;uival %u (0x%x)\n&quot;</span>, data.uival, data.uival);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;lval %ld\n&quot;</span>, data.lval);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ulval %lu (0x%lx)\n&quot;</span>, data.ulval, data.ulval);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Recommended pattern: a global variable that holds the entrypoint to</span></div>
<div class="line"><span class="comment"> * the supported commands, and a macro that is redefined after each</span></div>
<div class="line"><span class="comment"> * command is hooked in.  The macro allows commands to be disabled or</span></div>
<div class="line"><span class="comment"> * rearranged without having to change the links. */</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> * commandSet;</div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND NULL</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_h234 (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">          <span class="keywordtype">void</span> * param,</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">char</span> * argstr,</div>
<div class="line">          <span class="keywordtype">size_t</span> argstr_len)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot;Display: &quot;</span>);</div>
<div class="line">  <a class="code" href="group__grp__utility__cli__cli.html#ga733c7b931476c5f02c297dd7e0f78283">vBSP430cliConsoleDisplayChain</a>(chain, argstr);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == argstr_len) {</div>
<div class="line">    <a class="code" href="console_8h.html#a6e0a771b0a8f2034a7f49684b107542e">cputs</a>(<span class="stringliteral">&quot;\nWTH are we fighting for? Walk!&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_hup_two (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Give me a &#39;three&#39;\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_hup_two_three_four = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;four&quot;</span>,</div>
<div class="line">  .handler = cmd_h234</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_hup_two_three = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;three&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;# invalid if no four&quot;</span>,</div>
<div class="line">  .child = &amp;dcmd_hup_two_three_four,</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_hup_two = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;two&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;# valid if no three&quot;</span>,</div>
<div class="line">  .child = &amp;dcmd_hup_two_three,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_hup_two</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_hup = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;hup&quot;</span>,</div>
<div class="line">  .child = &amp;dcmd_hup_two,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#accbee4a1d6bf7d8ce245cf523efad821">next</a> = LAST_COMMAND,</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_hup</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_uptime (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Up %s\n&quot;</span>, <a class="code" href="uptime_8h.html#a790fc3c41c4a8e93ec7caca7825733c1">xBSP430uptimeAsText_ni</a>(<a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>()));</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_uptime = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;uptime&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;# Show system uptime&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_uptime</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_uptime</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_expand_ (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">             <span class="keywordtype">void</span> * param,</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">char</span> * argstr,</div>
<div class="line">             <span class="keywordtype">size_t</span> argstr_len)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot;Expanded: &quot;</span>);</div>
<div class="line">  <a class="code" href="group__grp__utility__cli__cli.html#ga733c7b931476c5f02c297dd7e0f78283">vBSP430cliConsoleDisplayChain</a>(chain, argstr);</div>
<div class="line">  <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_expand (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a64275e2d753ddf46981f77d33641bf17">iBSP430cliParseCommand</a>(commandSet, NULL, argstr, NULL, cmd_expand_);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_expand = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;expand&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[command...] # Show the expansion of the command without executing it&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_expand</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_expand</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_show (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  dumpData();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_show = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;show&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;# Display the value of variables&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_show</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_show</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_set_all (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">  rv = <a class="code" href="group__grp__utility__cli__hci.html#ga91a46c6159bd5218814c96cbc28a60db">iBSP430cliStoreExtractedI</a>(&amp;argstr, &amp;argstr_len, &amp;data.ival);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;data.uival);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gab8e5b1244aae36d13305065cd9c38f35">iBSP430cliStoreExtractedL</a>(&amp;argstr, &amp;argstr_len, &amp;data.lval);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gac1d3224f520dabd275954219dac876f8">iBSP430cliStoreExtractedUL</a>(&amp;argstr, &amp;argstr_len, &amp;data.ulval);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set_all = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;all&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[ival] [ [uival] [ [lval] [ [ulval] ] ] ]&quot;</span>,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_set_all</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set_ival = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;ival&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[signed 16-bit integer in octal, decimal, or hex]&quot;</span>,</div>
<div class="line">  .next = &amp;dcmd_set_all,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="group__grp__utility__cli__hci.html#ga95adee81f5988a74b1f64cb310c91476">iBSP430cliHandlerStoreI</a>,</div>
<div class="line">  .param.ptr = &amp;data.ival</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set_uival = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;uival&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[unsigned 16-bit integer in octal, decimal, or hex]&quot;</span>,</div>
<div class="line">  .next = &amp;dcmd_set_ival,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="group__grp__utility__cli__hci.html#ga721328d1d69213833e9f750ecdd7702a">iBSP430cliHandlerStoreUI</a>,</div>
<div class="line">  .param.ptr = &amp;data.uival</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set_lval = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;lval&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[signed 32-bit integer in octal, decimal, or hex]&quot;</span>,</div>
<div class="line">  .next = &amp;dcmd_set_uival,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="group__grp__utility__cli__hci.html#ga3cfe2e2c5faaf4e92180ee19ac548b7d">iBSP430cliHandlerStoreL</a>,</div>
<div class="line">  .param.ptr = &amp;data.lval</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set_ulval = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;ulval&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[unsigned 32-bit integer in octal, decimal, or hex]&quot;</span>,</div>
<div class="line">  .next = &amp;dcmd_set_lval,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="group__grp__utility__cli__hci.html#gac9d841bfe65ad69e59bf6028f3d61e56">iBSP430cliHandlerStoreUL</a>,</div>
<div class="line">  .param.ptr = &amp;data.ulval</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_set = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;set&quot;</span>,</div>
<div class="line">  .child = &amp;dcmd_set_ulval,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#accbee4a1d6bf7d8ce245cf523efad821">next</a> = LAST_COMMAND,</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_set</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_quote (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> arglen = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">size_t</span> len;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Extracting text tokens from %u characters\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)arglen);</div>
<div class="line">  <span class="keywordflow">while</span> (0 &lt; arglen) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * tp = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;arglen, &amp;len);</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%u-char token &lt;&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)len);</div>
<div class="line">    <span class="keywordflow">while</span> (len--) {</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(*tp++);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;&gt;\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_quote = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;quote&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[qstr]... # Extract one or more quoted tokens&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_quote</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_quote</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_dummy (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;dummy %s\n&quot;</span>, argstr);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#undef LAST_SUBCOMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUBCOMMAND NULL</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_complete_common = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;common&quot;</span>,</div>
<div class="line">  .next = LAST_SUBCOMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_dummy</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUBCOMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUBCOMMAND &amp;dcmd_complete_common</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_complete_component = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;component&quot;</span>,</div>
<div class="line">  .next = LAST_SUBCOMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_dummy</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUBCOMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUBCOMMAND &amp;dcmd_complete_component</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_complete = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;complete&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .child = LAST_SUBCOMMAND</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_complete</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> numbers[] = {</div>
<div class="line">  <span class="stringliteral">&quot;zero&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;one&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;two&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;three&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;four&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;five&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;six&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;seven&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;eight&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;nine&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ten&quot;</span></div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> number_len = <span class="keyword">sizeof</span>(numbers)/<span class="keyword">sizeof</span>(*numbers);</div>
<div class="line"><span class="preprocessor">#if (configBSP430_CLI_COMMAND_COMPLETION_HELPER - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCompletionHelperStrings.html">sBSP430cliCompletionHelperStrings</a> completion_helper_say = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCompletionHelperStrings.html#ab09d101593e2936842b9913a052bb8d5">completion_helper</a> = { .<a class="code" href="structsBSP430cliCompletionHelper.html#aa4eedca5d94e913b7946c1ac32539579">helper</a> = <a class="code" href="group__grp__utility__cli__completion.html#ga33939ab21b276f5aecfc2125e72c5568">vBSP430cliCompletionHelperStrings</a> },</div>
<div class="line">  .strings = numbers,</div>
<div class="line">  .len = <span class="keyword">sizeof</span>(numbers)/<span class="keyword">sizeof</span>(*numbers)</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* configBSP430_CLI_COMMAND_COMPLETION_HELPER */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_say (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">         <span class="keywordtype">void</span> * param,</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">char</span> * command,</div>
<div class="line">         <span class="keywordtype">size_t</span> command_len)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> * np = &amp;command;</div>
<div class="line">  <span class="keywordtype">int</span> nmatches = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (NULL != np) {</div>
<div class="line">    <span class="keywordtype">size_t</span> ocl = command_len;</div>
<div class="line">    np = <a class="code" href="group__grp__utility__cli__hci.html#ga28e7e4a8ab65e7240377f5327fc30256">xBSP430cliHelperStringsExtract</a>(&amp;completion_helper_say, &amp;command, &amp;command_len);</div>
<div class="line">    <span class="keywordflow">if</span> (NULL != np) {</div>
<div class="line">      ++nmatches;</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Match %s for %u consumed position %u\n&quot;</span>, *np,</div>
<div class="line">              (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(ocl - command_len),</div>
<div class="line">              (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(np - numbers));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%u matches found\n&quot;</span>, nmatches);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_say = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;say&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;{word}... # Customized completion demonstration&quot;</span>,</div>
<div class="line"><span class="preprocessor">#if (configBSP430_CLI_COMMAND_COMPLETION_HELPER - 0)</span></div>
<div class="line">  .completion_helper = &amp;completion_helper_say.<a class="code" href="structsBSP430cliCompletionHelperStrings.html#ab09d101593e2936842b9913a052bb8d5">completion_helper</a>,</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* configBSP430_CLI_COMMAND_COMPLETION_HELPER */</span><span class="preprocessor"></span></div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = cmd_say,</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND (&amp;dcmd_say)</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef RESPONSIVE_CCIDX</span></div>
<div class="line"><span class="preprocessor">#define RESPONSIVE_CCIDX 1</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RESPONSIVE_CCIDX */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>sResponsive {</div>
<div class="line">  <a class="code" href="structsBSP430timerAlarm.html">sBSP430timerAlarm</a> alarm;</div>
<div class="line">  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> wakeups;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> interval_tck;</div>
<div class="line">  <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> max_late;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lastDump_tck;</div>
<div class="line">} sResponsive;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> sResponsive responsiveData;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">responsive_cb_ni (<a class="code" href="structsBSP430timerAlarm.html">hBSP430timerAlarm</a> alarm)</div>
<div class="line">{</div>
<div class="line">  sResponsive * rdp = (sResponsive *)alarm;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> now_tck = <a class="code" href="timer_8h.html#a24b984912d7624627b33023f76c14d31">ulBSP430timerCounter_ni</a>(alarm-&gt;<a class="code" href="structsBSP430timerAlarm.html#a24d34f70d968e0cde40d35c6c0e21637">timer</a>, NULL);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> late_tck = now_tck - alarm-&gt;<a class="code" href="structsBSP430timerAlarm.html#aa42f23d79c51dc804e7e00a940b27277">setting_tck</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> setting_tck;</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (0 == rdp-&gt;wakeups) {</div>
<div class="line">    rdp-&gt;max_late = late_tck;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (late_tck &gt; rdp-&gt;max_late) {</div>
<div class="line">    rdp-&gt;max_late = late_tck;</div>
<div class="line">  }</div>
<div class="line">  rdp-&gt;wakeups++;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set the next setting.  Jump over all the missed alarms if we&#39;re</span></div>
<div class="line"><span class="comment">   * more than an interval late. */</span></div>
<div class="line">  setting_tck = alarm-&gt;<a class="code" href="structsBSP430timerAlarm.html#aa42f23d79c51dc804e7e00a940b27277">setting_tck</a>;</div>
<div class="line">  setting_tck += (late_tck / rdp-&gt;interval_tck) * rdp-&gt;interval_tck;</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    setting_tck += rdp-&gt;interval_tck;</div>
<div class="line">    rc = <a class="code" href="group__grp__timer__alarm.html#ga691c60553180266436fbea9a9a8bfed7">iBSP430timerAlarmSet_ni</a>(alarm, setting_tck);</div>
<div class="line">  } <span class="keywordflow">while</span> (0 &lt; rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_responsive (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  sResponsive state;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> resp_Hz;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> now_utt;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    now_utt = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">    resp_Hz = <a class="code" href="uptime_8h.html#abee524dac4c6d777b5493f1c16bc1c2a">ulBSP430uptimeConversionFrequency_Hz_ni</a>();</div>
<div class="line">    state = responsiveData;</div>
<div class="line">    responsiveData.wakeups = 0;</div>
<div class="line">    responsiveData.lastDump_tck = now_utt;</div>
<div class="line">  } <span class="keywordflow">while</span> (0);</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;State: %lu tick span with %lu wakeups\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\twakeup interval %lu tick (%lu us)\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\tlate maximum %lu tick (%lu us)\n&quot;</span>,</div>
<div class="line">          (now_utt - state.lastDump_tck), state.wakeups,</div>
<div class="line">          state.interval_tck, <a class="code" href="core_8h.html#a3f5213f6fd15b49cb3a6e0b511ba6787">BSP430_CORE_TICKS_TO_US</a>(state.interval_tck, resp_Hz),</div>
<div class="line">          state.max_late, <a class="code" href="core_8h.html#a3f5213f6fd15b49cb3a6e0b511ba6787">BSP430_CORE_TICKS_TO_US</a>(state.max_late, resp_Hz));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_responsive = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;responsive&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;# Display responsiveness data&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_responsive</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_responsive</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_help (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">          <span class="keywordtype">void</span> * param,</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">char</span> * command,</div>
<div class="line">          <span class="keywordtype">size_t</span> command_len)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__grp__utility__cli__cli.html#ga2c3a36a00ea6f676cf2006859364d45a">vBSP430cliConsoleDisplayHelp</a>(chain-&gt;<a class="code" href="structsBSP430cliCommandLink.html#ad4701a7a6b809d746683cb5b0a6f2018">cmd</a>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_help = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;help&quot;</span>,</div>
<div class="line">  .help = <span class="stringliteral">&quot;[cmd] # Show help on cmd or all commands&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = cmd_help</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_help</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main ()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * command;</div>
<div class="line">  <a class="code" href="structsBSP430timerAlarm.html">hBSP430timerAlarm</a> rh;</div>
<div class="line">  <span class="keywordtype">int</span> flags;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="platform_8h.html#a616515ce5e0f7635ca36a815841d2a21">vBSP430platformInitialize_ni</a>();</div>
<div class="line">  (void)<a class="code" href="console_8h.html#a91f5f68fa2ee29ca39bf9a23ea98cbe1">iBSP430consoleInitialize</a>();</div>
<div class="line">  <a class="code" href="cli_8h.html#a0a5b3cee7e2d9002d5d301b36c814d55">vBSP430cliSetDiagnosticFunction</a>(<a class="code" href="group__grp__utility__cli__cli.html#ga30922f40d6b2702628bb88d9e0069caf">iBSP430cliConsoleDiagnostic</a>);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\ncli example &quot;</span> __DATE__ <span class="stringliteral">&quot; &quot;</span> __TIME__ <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#if (configBSP430_CLI_COMMAND_COMPLETION - 0)</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Command completion is available.\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* configBSP430_CLI_COMMAND_COMPLETION */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (BSP430_PMM_SUPPORTS_SVSM - 0)</span></div>
<div class="line">  <a class="code" href="pmm_8h.html#a0bf0ec44ad7918e57576e4612cc307ae">BSP430_PMM_SET_SVSMCTL_NI</a>(<a class="code" href="msp430_8h.html#ac11a993ad6c277854031e52bd2b1c4c1">SVSMHCTL</a> &amp; ~(<a class="code" href="msp430_8h.html#a79ec91d113a53e08d99d7df061bb99cc">SVMHE</a> | <a class="code" href="msp430_8h.html#aa303492df56594c301a5d90a85dfcfce">SVSHE</a>), <a class="code" href="msp430_8h.html#a851565872e6d9b1b747449156a44d81d">SVSMLCTL</a> &amp; ~(<a class="code" href="msp430_8h.html#a80f9b1f14a3e0b92470f442c97da6688">SVMLE</a> | <a class="code" href="msp430_8h.html#a775b67a8c2df6ecf7225c8de70631ead">SVSLE</a>));</div>
<div class="line"><span class="preprocessor">#endif // BSP430_PMM_SUPPORTS_SVSM</span></div>
<div class="line"></div>
<div class="line">  rh = <a class="code" href="group__grp__timer__alarm.html#ga006a132cabb227524de5203697814c12">hBSP430timerAlarmInitialize</a>(&amp;responsiveData.alarm,</div>
<div class="line">                                   <a class="code" href="uptime_8h.html#a6d4b3ca225b4057be8a5c6f05de6eb7e">BSP430_UPTIME_TIMER_PERIPH_HANDLE</a>,</div>
<div class="line">                                   RESPONSIVE_CCIDX,</div>
<div class="line">                                   responsive_cb_ni);</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == rh) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Failed to initialize responsiveness alarm\n&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">int</span> rc;</div>
<div class="line"></div>
<div class="line">    responsiveData.wakeups = 0;</div>
<div class="line">    responsiveData.interval_tck = 10;</div>
<div class="line">    responsiveData.max_late = 0;</div>
<div class="line">    responsiveData.lastDump_tck = 32768 + <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">    rc = <a class="code" href="group__grp__timer__alarm.html#gaf78fc60de828bc03bb7c93624f384ef1">iBSP430timerAlarmSetEnabled_ni</a>(rh, 1);</div>
<div class="line">    <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">      rc = <a class="code" href="group__grp__timer__alarm.html#ga691c60553180266436fbea9a9a8bfed7">iBSP430timerAlarmSet_ni</a>(rh, responsiveData.lastDump_tck);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (0 != rc) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Failed to initialize alarm\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 1);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nLED lit when not awaiting input\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* NOTE: The control flow in this is a bit tricky, as we&#39;re trying</span></div>
<div class="line"><span class="comment">   * to leave interrupts enabled during the main body of the loop,</span></div>
<div class="line"><span class="comment">   * while they must be disabled when processing input to recognize a</span></div>
<div class="line"><span class="comment">   * command.  The flags variable preserves state across multiple loop</span></div>
<div class="line"><span class="comment">   * iterations until all relevant activities have completed. */</span></div>
<div class="line">  commandSet = LAST_COMMAND;</div>
<div class="line">  command = NULL;</div>
<div class="line">  flags = <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69deaf4a31c8e1956488e1ff37d22d55936b3">eBSP430cliConsole_REPAINT</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#a954f39fe5652611f5a20f74289b0cfbf">BSP430_CORE_ENABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69dea5a05d17ffe59e202f061455f77b12c92">eBSP430cliConsole_ANY_ESCAPE</a>) {</div>
<div class="line">      <span class="keywordtype">int</span> c;</div>
<div class="line">      <span class="keywordflow">while</span> (0 &lt;= ((c = <a class="code" href="console_8h.html#a1ea443e362fde4016b85cdf7676b7872">cgetchar</a>()))) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;escape char 0x%02x (%u) &#39;%c&#39;\n&quot;</span>, c, c, isprint(c) ? c : <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">        <span class="comment">/* Technically CSI is a single character 0x9b representing</span></div>
<div class="line"><span class="comment">         * ESC+[.  In the two-character mode accepted here, we use the</span></div>
<div class="line"><span class="comment">         * value for the second character. */</span></div>
<div class="line"><span class="preprocessor">#define KEY_CSI &#39;[&#39;</span></div>
<div class="line">        <span class="keywordflow">if</span> ((KEY_CSI == c) &amp;&amp; (flags &amp; <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69dea35ef4020932be71bd87834c27fd16c08">eBSP430cliConsole_PROCESS_ESCAPE</a>)) {</div>
<div class="line">          flags &amp;= ~eBSP430cliConsole_PROCESS_ESCAPE;</div>
<div class="line">          flags |= <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69dea736f64677f998edc054fef9479f388f0">eBSP430cliConsole_IN_ESCAPE</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((64 &lt;= c) &amp;&amp; (c &lt;= 126)) {</div>
<div class="line">          flags &amp;= ~eBSP430cliConsole_ANY_ESCAPE;</div>
<div class="line">          <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Leaving escape mode\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_DO_COMPLETION) {</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_DO_COMPLETION;</div>
<div class="line">      flags |= <a class="code" href="group__grp__utility__cli__completion.html#ga5086d946e412fa4e9928819d664fc2cc">iBSP430cliConsoleBufferCompletion</a>(commandSet, &amp;command);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_READY) {</div>
<div class="line">      <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">      rv = <a class="code" href="cli_8h.html#adcdb159a40c5cb6737cf97b497b58a55">iBSP430cliExecuteCommand</a>(commandSet, 0, command);</div>
<div class="line">      <span class="keywordflow">if</span> (0 != rv) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Command execution returned %d\n&quot;</span>, rv);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">/* Ensure prompt is rewritten, but not the command we just</span></div>
<div class="line"><span class="comment">       * ran */</span></div>
<div class="line">      flags |= <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69deaf4a31c8e1956488e1ff37d22d55936b3">eBSP430cliConsole_REPAINT</a>;</div>
<div class="line">      command = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_REPAINT) {</div>
<div class="line">      <span class="comment">/* Draw the prompt along with whatever&#39;s left in the command</span></div>
<div class="line"><span class="comment">       * buffer.  Note use of leading carriage return in case an edit</span></div>
<div class="line"><span class="comment">       * left material on the current line. */</span></div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\r&gt; %s&quot;</span>, command ? command : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_REPAINT;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_REPAINT_BEL) {</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\a&#39;</span>);</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_REPAINT_BEL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_READY) {</div>
<div class="line">      <span class="comment">/* Clear the command we just completed */</span></div>
<div class="line">      <a class="code" href="group__grp__utility__cli__cli.html#ga15ac053830a35c1b1410fda48c0e7e3a">vBSP430cliConsoleBufferClear</a>();</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_READY;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">      <span class="comment">/* Unless we&#39;re processing application-specific escape</span></div>
<div class="line"><span class="comment">       * characters let iBSP430cliConsoleBufferProcessInput_ni()</span></div>
<div class="line"><span class="comment">       * process any input characters that have already been</span></div>
<div class="line"><span class="comment">       * received. */</span></div>
<div class="line">      <span class="keywordflow">if</span> (! (flags &amp; eBSP430cliConsole_ANY_ESCAPE)) {</div>
<div class="line">        flags |= <a class="code" href="group__grp__utility__cli__cli.html#gaf192635722fef70abb4583a1c52a4e7a">iBSP430cliConsoleBufferProcessInput</a>();</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (0 == flags) {</div>
<div class="line">        <span class="comment">/* Sleep until something wakes us, such as console input.</span></div>
<div class="line"><span class="comment">         * Then turn off interrupts and loop back to read that</span></div>
<div class="line"><span class="comment">         * input. */</span></div>
<div class="line">        <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 0);</div>
<div class="line">        <a class="code" href="core_8h.html#a1b153003ca93d41bd574dcd4790feb6d">BSP430_CORE_LPM_ENTER</a>(<a class="code" href="msp430_8h.html#a44fde789b84d1b15c41e577d6a080eff">LPM0_bits</a>);</div>
<div class="line">        <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 1);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">/* Repeat if still nothing to do */</span></div>
<div class="line">    } <span class="keywordflow">while</span> (! flags);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Got something to do; get the command contents in place so</span></div>
<div class="line"><span class="comment">     * we can update the screen. */</span></div>
<div class="line">    command = <a class="code" href="group__grp__utility__cli__cli.html#ga634626363e043b2a1efa7fb7b657ebe4">xBSP430cliConsoleBuffer</a>();</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ex_utility_cli_confic"></a>
bsp430_config.h</h1>
<div class="fragment"><div class="line"><span class="comment">/* Use a crystal if one is installed.  Much more accurate timing</span></div>
<div class="line"><span class="comment"> * results. */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_BOOT_CONFIGURE_LFXT1 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Application does output: support spin-for-jumper */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_PLATFORM_SPIN_FOR_JUMPER 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Support console output */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CONSOLE 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable an 8-character rx buffer for the console */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_CONSOLE_RX_BUFFER_SIZE 8</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable an 80-character command buffer */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_CLI_CONSOLE_BUFFER_SIZE 80</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable command completion, and completion helper */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CLI_COMMAND_COMPLETION 1</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CLI_COMMAND_COMPLETION_HELPER 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Monitor uptime and provide generic ACLK-driven timer */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_UPTIME 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Get platform defaults */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bsp430__config_8h.html">bsp430/platform/bsp430_config.h</a>&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="ex_utility_cli_make"></a>
Makefile</h1>
<div class="fragment"><div class="line">PLATFORM ?= exp430f5438</div>
<div class="line">MODULES=$(MODULES_PLATFORM)</div>
<div class="line">MODULES += $(MODULES_UPTIME)</div>
<div class="line">MODULES += $(MODULES_CONSOLE)</div>
<div class="line">MODULES += utility/cli</div>
<div class="line">SRC=main.c</div>
<div class="line">include $(BSP430_ROOT)/examples/Makefile.common</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 10 2014 14:22:18 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
