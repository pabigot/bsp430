<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BSP430: Bootstrapping a New Platform: Console Output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20130427</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Bootstrapping a New Platform: Console Output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BSP430 provides a <a class="el" href="console_8h.html#a7e7be9a93cd9726e38378c1736d3b239">standard console facility </a> which gives you a 9600 baud 8N1 terminal along with <a class="el" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf()</a> and related routines to output formatted text. It also supports input with <a class="el" href="console_8h.html#ab51614b234cfd24eed353dde0d9f014c">cgetchar_ni()</a>.</p>
<p>This application loops forever, printing a counter and blinking an LED every half second, and displaying any input characters that were received between outputs. The LEDs are a visual cue that the program is running even if something's wrong with the serial output.</p>
<p>Be aware that, unless <a class="el" href="console_8h.html#a8f5e617854ea03057eb555413356a0d7">BSP430_CONSOLE_RX_BUFFER_SIZE</a> is set to a positive value, the receive infrastructure has only the one byte UART buffer available, and typing more than that between display updates will result in lost characters. This can be achieved by adding the following to the make command line when building the application: </p>
<pre class="fragment">AUX_CPPFLAGS=-DBSP430_CONSOLE_RX_BUFFER_SIZE=16
</pre><p><code>APP_VERBOSE</code> may be defined to 1 while building this application; with that flag, the number of characters transmitted and received, and the UART status register, are displayed on each iteration: </p>
<pre class="fragment">AUX_CPPFLAGS=-DAPP_VERBOSE=1
</pre><h1><a class="anchor" id="ex_bootstrap_console_main"></a>
main.c</h1>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html" title="Entrypoint for platform-specific capabilities.">bsp430/platform.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* We&#39;re going to use LEDs so we need the interface. */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="led_8h.html" title="Support for platform-independent LED manipulation.">bsp430/utility/led.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* We want to know the nominal clock speed so we can delay the</span></div>
<div class="line"><span class="comment"> * appropriate interval. */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html" title="Clock-related functions implemented on all MSP430 MCUs.">bsp430/clock.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* We require console support as verified by &lt;bsp430/platform.h&gt; */</span></div>
<div class="line"><span class="preprocessor">#ifndef BSP430_CONSOLE</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#error No console UART PERIPH handle has been defined</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* BSP430_CONSOLE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="console_8h.html" title="A generic console output capability.">bsp430/utility/console.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main ()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"><span class="preprocessor">#if APP_VERBOSE - 0</span></div>
<div class="line"><span class="preprocessor"></span>  <a class="code" href="structsBSP430halSERIAL.html">hBSP430halSERIAL</a> console;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* APP_VERBOSE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <span class="comment">/* Initialize platform. */</span></div>
<div class="line">  <a class="code" href="platform_8h.html#a616515ce5e0f7635ca36a815841d2a21">vBSP430platformInitialize_ni</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Turn on the first LED */</span></div>
<div class="line">  <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 1);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Configure the console to use the default UART handle */</span></div>
<div class="line">  rv = <a class="code" href="console_8h.html#a91f5f68fa2ee29ca39bf9a23ea98cbe1">iBSP430consoleInitialize</a>();</div>
<div class="line">  <span class="comment">/* assert(0 == rv); */</span></div>
<div class="line"><span class="preprocessor">#if APP_VERBOSE - 0</span></div>
<div class="line"><span class="preprocessor"></span>  console = <a class="code" href="console_8h.html#a641b6419ca463bcb87d4ec1645928c0b">hBSP430console</a>();</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* APP_VERBOSE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <span class="comment">/* Indicate we made it this far. */</span></div>
<div class="line">  <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(1, 1);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (0 &gt; rv) {</div>
<div class="line">    <span class="comment">/* Failed to configure the UART HAL */</span></div>
<div class="line">    <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, 0);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> counter = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Now blink and display a counter value every nominal half</span></div>
<div class="line"><span class="comment">     * second.  The blink proves that the loop is running even if</span></div>
<div class="line"><span class="comment">     * nothing&#39;s coming out the serial port.  On each iteration,</span></div>
<div class="line"><span class="comment">     * attempt to read a character and display it if one is</span></div>
<div class="line"><span class="comment">     * present. */</span></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">      <span class="keywordtype">int</span> rc;</div>
<div class="line">      <a class="code" href="core_8h.html#ae7df9374f27e94580ce596ad98949dcd">BSP430_CORE_WATCHDOG_CLEAR</a>();</div>
<div class="line"><span class="preprocessor">#if (BSP430_CONSOLE_RX_BUFFER_SIZE - 0) || (BSP430_CONSOLE_TX_BUFFER_SIZE - 0)</span></div>
<div class="line"><span class="preprocessor"></span>      <span class="comment">/* If we&#39;re using interrupt-driven transmission or reception, we&#39;d</span></div>
<div class="line"><span class="comment">       * better enable interrupts. */</span></div>
<div class="line">      <a class="code" href="core_8h.html#a954f39fe5652611f5a20f74289b0cfbf">BSP430_CORE_ENABLE_INTERRUPT</a>();</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_CONSOLE_RX_BUFFER_SIZE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="core_8h.html#a327cb5d1a1607c19c9551a18507bbb63">BSP430_CORE_DELAY_CYCLES</a>(<a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a> / 2);</div>
<div class="line"><span class="preprocessor">#if (BSP430_CONSOLE_RX_BUFFER_SIZE - 0) || (BSP430_CONSOLE_TX_BUFFER_SIZE - 0)</span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_CONSOLE_RX_BUFFER_SIZE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>      <span class="keywordflow">while</span> (0 &lt;= ((rc = <a class="code" href="console_8h.html#ab51614b234cfd24eed353dde0d9f014c">cgetchar_ni</a>()))) {</div>
<div class="line">        <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot; rx char &quot;</span>);</div>
<div class="line">        <a class="code" href="console_8h.html#a9eadeedb5083ccde64a4b88552ae0a62">cputu_ni</a>(rc, 10);</div>
<div class="line">        <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot; &#39;&quot;</span>);</div>
<div class="line">        <a class="code" href="console_8h.html#a46ea793d7dd79b66e1c3a195d0d4a7b1">cputchar_ni</a>(rc);</div>
<div class="line">        <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot;\nctr &quot;</span>);</div>
<div class="line">      <a class="code" href="console_8h.html#a9eadeedb5083ccde64a4b88552ae0a62">cputu_ni</a>(counter, 10);</div>
<div class="line"><span class="preprocessor">#if APP_VERBOSE - 0</span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot;; tx &quot;</span>);</div>
<div class="line">      <a class="code" href="console_8h.html#ab775380be085f01d132f9ccf8a70a2c2">cputul_ni</a>(console-&gt;<a class="code" href="structsBSP430halSERIAL.html#ab96893c7c8a493681cda94f69e97d9c3">num_tx</a>, 10);</div>
<div class="line">      <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot;; rx &quot;</span>);</div>
<div class="line">      <a class="code" href="console_8h.html#ab775380be085f01d132f9ccf8a70a2c2">cputul_ni</a>(console-&gt;<a class="code" href="structsBSP430halSERIAL.html#a1e2a97da554ce15b300b5196298c2111">num_rx</a>, 10);</div>
<div class="line">      <a class="code" href="console_8h.html#a90148fb44b9e9b2b952d6ba8e42b317d">cputtext_ni</a>(<span class="stringliteral">&quot;; stat 0x&quot;</span>);</div>
<div class="line"><span class="preprocessor">#if configBSP430_SERIAL_USE_USCI - 0</span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="console_8h.html#a9eadeedb5083ccde64a4b88552ae0a62">cputu_ni</a>(console-&gt;hpl.<a class="code" href="structsBSP430halSERIAL.html#a46ae7c8c6d3e32d476db03c17aaad578">usci</a>-&gt;<a class="code" href="structsBSP430hplUSCI.html#a5def5813240b818a12353a6c318d52ed">stat</a>, 16);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if configBSP430_SERIAL_USE_USCI5 - 0</span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="console_8h.html#a9eadeedb5083ccde64a4b88552ae0a62">cputu_ni</a>(console-&gt;hpl.<a class="code" href="structsBSP430halSERIAL.html#a8794eb0bbd174918043a8f32e48d45a7">usci5</a>-&gt;<a class="code" href="structsBSP430hplUSCI5.html#a8fe3e0cd6ef1a4508cd907c14d4a4555">stat</a>, 16);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if configBSP430_SERIAL_USE_EUSCI - 0</span></div>
<div class="line"><span class="preprocessor"></span>      <a class="code" href="console_8h.html#a9eadeedb5083ccde64a4b88552ae0a62">cputu_ni</a>(console-&gt;hpl.<a class="code" href="structsBSP430halSERIAL.html#a30424a6ad26b1660f215a5a3b98e24d5">euscia</a>-&gt;<a class="code" href="structsBSP430hplEUSCIA.html#ad0fe60afb08c31522ff25f35b4db6632">statw</a>, 16);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* APP_VERBOSE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>      ++counter;</div>
<div class="line">      <a class="code" href="led_8h.html#ae66246141775652517b8a6fe88537360">vBSP430ledSet</a>(0, -1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ex_bootstrap_console_confic"></a>
bsp430_config.h</h1>
<div class="fragment"><div class="line"><span class="comment">/* Application does output: support spin-for-jumper */</span></div>
<div class="line"><span class="preprocessor">#ifndef configBSP430_PLATFORM_SPIN_FOR_JUMPER</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define configBSP430_PLATFORM_SPIN_FOR_JUMPER 1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* configBSP430_PLATFORM_SPIN_FOR_JUMPER */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* Request console resources */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CONSOLE 1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* In verbose mode, the number of characters transmitted and received, and</span></div>
<div class="line"><span class="comment"> * the raw status of the UART, are displayed on each iteration. */</span></div>
<div class="line"><span class="preprocessor">#ifndef APP_VERBOSE</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define APP_VERBOSE 0</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* APP_VERBOSE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bsp430__config_8h.html" title="BSP430 application and platform configuration directives.">bsp430/platform/bsp430_config.h</a>&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="ex_bootstrap_console_make"></a>
Makefile</h1>
<div class="fragment"><div class="line">PLATFORM ?= exp430fr5739</div>
<div class="line">MODULES=$(MODULES_PLATFORM) $(MODULES_CONSOLE)</div>
<div class="line">SRC=main.c</div>
<div class="line">include $(BSP430_ROOT)/examples/Makefile.common</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 27 2013 18:46:22 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
